---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.14.7
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

<!-- #region id="XetvxEdeP_9R" -->
# Feature Selection
<!-- #endregion -->

```{python id="SKFmAIzF5K8j"}
import time
import datetime
import pandas as pd
import numpy as np
import warnings
warnings.simplefilter('ignore')


from sklearn.model_selection import train_test_split
```

<!-- #region id="xyDs-W29Q0L8" -->
## Extracting  Features (Day of week / Day of Month)
<!-- #endregion -->

```{python id="lApedAYa__Iy"}
df = df.sort_values(['date'])
```

```{python colab={'base_uri': 'https://localhost:8080/', 'height': 204}, id="JkT0Cfe3KcfI", outputId="f7cd6dd7-68c7-4200-fed2-52cdeaa050ff"}
# Extracting new features based on pickup date

df['date']=df['date'].astype('datetime64')

# Extract the pickup day of the month from the datetime column
df['PU_day_of_month'] = df['date'].dt.day.astype(np.uint8)

# Extract the pickup day of the week (0-6) from the datetime column
df['PU_day_of_week'] = df['date'].dt.weekday.astype(np.uint8)

df.head(5)
```

<!-- #region id="n3z43ZwBQ9aU" -->
## Extracting  Features (last_day_deman_cnt / last_week_deman_cnt)

<!-- #endregion -->

```{python id="ss0dGcrkQ_uf"}
df['last_day'] = ''
df['last_week'] = ''
for i in df.index:
    df['last_day'].loc[i] = df['date'].loc[i] - datetime.timedelta(days=1)
    df['last_week'].loc[i] = df['date'].loc[i] - datetime.timedelta(days=7)
```

```{python colab={'base_uri': 'https://localhost:8080/', 'height': 333}, id="mHzA0JqTm6-O", outputId="4b7e8160-483a-4436-97b5-8f4aecb3b479"}
def last_demand_count(df,last_date,LID):
    return (df[(df['date'] == last_date) & (df['PULocationID'] == LID)]['count']).values[0]


df['last_day_demand_cnt'] = 0
df['last_week_demand_cnt'] = 0
for i in df.index:
    try:
        df['last_day_demand_cnt'].loc[i] = last_demand_count(df,df['last_day'].loc[i],df['PULocationID'].loc[i])
    except IndexError:
        df['last_day_demand_cnt'].loc[i] = 0

    try:
            df['last_week_demand_cnt'].loc[i] = last_demand_count(df,df['last_week'].loc[i],df['PULocationID'].loc[i])
    except IndexError:
        df['last_week_demand_cnt'].loc[i] = 0

df.head(5)
```

```{python id="sk32WEWjpVdB"}
df.to_parquet('../data/featureDS.parquet')
```

```{python id="fNfRlslxJj-_"}
test_data = df[df['date'] >= datetime.datetime(2023, 4, 1)]
df = df[df['date'] < datetime.datetime(2023, 4, 1)]
```

```{python id="uFPI1eCYqYyB"}
df = df.drop(['date', 'last_day', 'last_week'], axis=1)
test_data = test_data.drop(['date', 'last_day', 'last_week'], axis=1)
```

```{python id="eoTmtHn-ruLL"}
X = df.drop('count', axis=1)
target = df['count']
```

```{python id="UsFqNzGYhw_i"}
X_train, X_test, y_train, y_test = train_test_split(X, target, test_size=0.2, shuffle=False)
```
